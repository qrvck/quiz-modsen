echo ""
echo "ğŸ” Running pre-commit checks..."
echo ""

STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACMR | grep -E '\.(ts|tsx|js|jsx)$' | tr '\n' ' ')

if [ -z "$STAGED_FILES" ]; then
  echo "No JavaScript/TypeScript files to check."
  exit 0
fi

echo "ğŸ”§ Running ESLint..."
if ! npx eslint $STAGED_FILES --fix; then
  echo ""
  echo "âŒ ESLint failed. Please fix the errors above."
  echo ""
  exit 1
fi

echo ""
echo "âœ… ESLint passed!"

echo ""
echo "ğŸ§ª Running tests..."
if ! npx jest --config=jest/jest.config.js --findRelatedTests $STAGED_FILES --bail --passWithNoTests; then
  echo ""
  echo "âŒ Tests failed. Please fix the tests above."
  echo ""
  exit 1
fi

echo ""
echo "âœ… Tests passed!"

echo ""
echo "ğŸ“ Adding fixed files..."
git add $STAGED_FILES

echo ""
echo "âœ… All checks passed!"
echo ""