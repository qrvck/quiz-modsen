echo ""
echo "🔍 Running pre-commit checks..."
echo ""

STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACMR | grep -E '\.(ts|tsx|js|jsx)$' | tr '\n' ' ')

if [ -z "$STAGED_FILES" ]; then
  echo "No JavaScript/TypeScript files to check."
  exit 0
fi

echo "🔧 Running ESLint..."
if ! npx eslint $STAGED_FILES --fix; then
  echo ""
  echo "❌ ESLint failed. Please fix the errors above."
  echo ""
  exit 1
fi

echo ""
echo "✅ ESLint passed!"

echo ""
echo "🧪 Running tests..."
if ! npx jest --config=jest/jest.config.js --findRelatedTests $STAGED_FILES --bail --passWithNoTests; then
  echo ""
  echo "❌ Tests failed. Please fix the tests above."
  echo ""
  exit 1
fi

echo ""
echo "✅ Tests passed!"

echo ""
echo "📝 Adding fixed files..."
git add $STAGED_FILES

echo ""
echo "✅ All checks passed!"
echo ""